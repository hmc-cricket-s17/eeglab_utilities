%%%%%%%%%%%%%%% reaction_time_event %%%%%%%%%%%%%%%%%%%%%%
%% This script is to add reaction time field for each event
% Developed by Shota Yasunaga
% Developed on Matlab 2016b
% The code is developed on LIVE lab scrips developed 
% by Michael Spezio



%% Specify data directory
EEGDataDir = '/Users/mspezio/Downloads';

%% Export events
EEG = eeg_checkset( EEG );
pop_expevents(EEG, fullfile(EEGDataDir,'events.csv'), 'samples');

%% Read in the events
fid = fopen(fullfile(EEGDataDir,'events.csv'));
evinfo = textscan(fid,...
    '%d%s%f%d%f%d',...
    'headerlines',1);
fclose(fid);

%% Find the trial starts and their indices and add field info accordingly
newevfield = 'rt'; % Hey, this means reaction time, not rectangle
TrialStartInds = strmatch('STR',evinfo{2});
num_trials = length(TrialStartInds);
for trial_num = 1:num_trials-1
    start_trial_ind = TrialStartInds(trial_num);
    end_trial_ind = TrialStartInds(trial_num+1)-1;
    
    [newcellarraystring{1:length(start_trial_ind:end_trial_ind)}] = ...
        deal(sprintf('Trial%d',trial_num));
    
    EEG = pop_editeventfield(EEG,...
        newevfield,...
        newcellarraystring,...
        'trialnum_info','Trial Number',...
        'indices',[start_trial_ind:end_trial_ind]);
end

